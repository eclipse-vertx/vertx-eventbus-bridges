= Vert.x gRPC EventBus Bridge

Vert.x gRPC EventBus Bridge is a gRPC bridge to Vert.x EventBus.
To use this project, add the following dependency to the _dependencies_ section of your build descriptor:

[tabs]
====
Maven::
+
[source,xml,subs="+attributes"]
----
<dependency>
  <groupId>${maven.groupId}</groupId>
  <artifactId>${maven.artifactId}</artifactId>
  <version>${maven.version}</version>
</dependency>
----

Gradle::
+
[source,groovy,subs="+attributes"]
----
compile '${maven.groupId}:${maven.artifactId}:${maven.version}'
----
====

The gRPC EventBus Bridge is built on top of gRPC, meaning that any application that can create gRPC clients can interact with a remote Vert.x instance via its event bus.
The main use case for the gRPC bridge is for applications that need a standardized, high-performance, and language-agnostic way to communicate with a Vert.x EventBus. gRPC provides a modern, open-source RPC framework that uses HTTP/2 for transport, Protocol Buffers as the interface description language.
The bridge also supports gRPC-Web, allowing web clients to communicate with the gRPC server.

== Protocol Description

The gRPC EventBus Bridge uses Protocol Buffers to define the service and message structures.
The service definition includes the following operations:

1. `Publish`: Publishes a message to an address (one-way communication)
2. `Send`: Sends a message to an address (point-to-point)
3. `Request`: Implements the request-reply pattern
4. `Subscribe`: Subscribes to messages from an address (returns a stream of messages)
5. `Unsubscribe`: Unsubscribes from an address
6. `Ping`: Health check

The message structures are defined as follows:

=== PublishOp

Used for publishing messages to an address:

[source,proto]
----
message PublishOp {
  // The address the message was sent to
  string address = 1;

  // Message headers
  map<string, string> headers = 2;

  // Message payload as structured data
  google.protobuf.Struct body = 3;
}
----

=== SendOp

Used for sending messages to an address (point-to-point):

[source,proto]
----
message SendOp {
  // The address the message was sent to
  string address = 1;

  // Optional reply address
  string reply_address = 2;

  // Message headers
  map<string, string> headers = 3;

  // Message payload as structured data
  google.protobuf.Struct body = 4;

  // Timeout in milliseconds
  google.protobuf.Duration timeout = 5;
}
----

=== RequestOp

Used for request-reply pattern:

[source,proto]
----
message RequestOp {
  // The address the message was sent to
  string address = 1;

  // Optional reply address
  string reply_address = 2;

  // Message headers
  map<string, string> headers = 3;

  // Message payload as structured data
  google.protobuf.Struct body = 4;

  // Timeout in milliseconds
  google.protobuf.Duration timeout = 5;
}
----

=== SubscribeOp

Used for subscribing to an address:

[source,proto]
----
message SubscribeOp {
  // The address to subscribe to
  string address = 1;

  // Consumer for subscription management
  string consumer = 2;

  // Message headers
  map<string, string> headers = 3;
}
----

=== UnsubscribeOp

Used for unsubscribing from an address:

[source,proto]
----
message UnsubscribeOp {
  // The address to unsubscribe from
  string address = 1;

  // Consumer for subscription management
  string consumer = 2;
}
----

=== EventBusMessage

Used for receiving messages from the EventBus:

[source,proto]
----
message EventBusMessage {
  // The address the message was sent to
  string address = 1;

  // Consumer for subscription management
  string consumer = 2;

  // Optional reply address
  string reply_address = 3;

  // Message headers
  map<string, string> headers = 4;

  // Message payload
  google.protobuf.Struct body = 5;

  // Optional status for error responses
  google.rpc.Status status = 6;
}
----

== Usage Examples

=== Creating a gRPC EventBus Bridge Server

Here's an example of how to create and start a gRPC EventBus Bridge server:

[source,java]
----
{@link examples.grpc.GrpcBridgeExamples#createServer}
----

=== Creating a gRPC Client

Here's how to create a gRPC client to connect to the bridge:

[source,java]
----
{@link examples.grpc.GrpcBridgeExamples#createClient}
----

=== Sending Messages

To send a message to an address:

[source,java]
----
{@link examples.grpc.GrpcBridgeExamples#sendMessage}
----

=== Request-Response Pattern

To send a request and receive a response:

[source,java]
----
{@link examples.grpc.GrpcBridgeExamples#requestResponse}
----

=== Publishing Messages

To publish a message to all subscribers:

[source,java]
----
{@link examples.grpc.GrpcBridgeExamples#publishMessage}
----

=== Subscribing to Messages

To subscribe to messages from an address:

[source,java]
----
{@link examples.grpc.GrpcBridgeExamples#subscribeToMessages}
----

=== Unsubscribing from Messages

To unsubscribe from an address:

[source,java]
----
{@link examples.grpc.GrpcBridgeExamples#unsubscribeFromMessages}
----

=== Health Check

To perform a health check:

[source,java]
----
{@link examples.grpc.GrpcBridgeExamples#healthCheck}
----

== Using GrpcEventBusBridgeService with Custom gRPC Server

While the previous examples show how to create a standalone gRPC EventBus Bridge server, you may want to integrate the EventBus bridge functionality into an existing custom gRPC server that already hosts other services.
The `GrpcEventBusBridgeService` allows you to do exactly that.

=== Integration with Custom gRPC Server

Here's how to integrate the EventBus bridge service into your existing gRPC server:

[source,java]
----
{@link examples.grpc.GrpcBridgeExamples#createCustomServerWithBridgeService}
----

=== Custom Server with Multiple Services

You can easily combine the EventBus bridge with your own custom gRPC services:

[source,java]
----
{@link examples.grpc.GrpcBridgeExamples#createServerWithMultipleServices}
----

=== Advanced Configuration

The `GrpcEventBusBridgeService` supports the same configuration options as the standalone bridge:

[source,java]
----
{@link examples.grpc.GrpcBridgeExamples#createBridgeServiceWithAdvancedConfig}
----
